{{- define "main" }}

<header class="page-header">
  <h1>{{ .Title }}</h1>
  {{- if .Description }}
  <div class="post-description">
    {{ .Description }}
  </div>
  {{- end }}
</header>

{{- $projects := where .Pages "Kind" "page" }}
{{- $ipProjects := where $projects ".Params.role" "ip" }}
{{- $collabProjects := where $projects ".Params.role" "collaborator" }}

<!-- IP Projects Section -->
{{- if $ipProjects }}
<section class="projects-section">
  <h2 class="projects-section-title">Principal Investigator</h2>
  <div class="cards-grid">
    {{- range $ipProjects.ByParam "weight" }}
    <a href="{{ .Permalink }}" class="project-card">
      {{- if .Params.cover.image }}
      <img src="{{ .Params.cover.image }}" alt="{{ .Params.cover.alt | default .Title }}" class="card-image">
      {{- end }}
      <div class="card-content">
        <h3 class="card-title">{{ .Title }}</h3>
        <p class="card-description">
          {{ .Description }}
        </p>
        {{- if .Params.tags }}
        <div class="card-tags">
          {{- range .Params.tags }}
          <span class="card-tag">{{ . }}</span>
          {{- end }}
        </div>
        {{- end }}
      </div>
    </a>
    {{- end }}
  </div>
</section>
{{- end }}

<!-- Collaborator Projects Section -->
{{- if $collabProjects }}
<section class="projects-section">
  <h2 class="projects-section-title">Collaborations</h2>
  <div class="cards-grid">
    {{- range $collabProjects.ByParam "weight" }}
    <a href="{{ .Permalink }}" class="project-card">
      {{- if .Params.cover.image }}
      <img src="{{ .Params.cover.image }}" alt="{{ .Params.cover.alt | default .Title }}" class="card-image">
      {{- end }}
      <div class="card-content">
        <h3 class="card-title">{{ .Title }}</h3>
        <p class="card-description">
          {{ .Description }}
        </p>
        {{- if .Params.tags }}
        <div class="card-tags">
          {{- range .Params.tags }}
          <span class="card-tag">{{ . }}</span>
          {{- end }}
        </div>
        {{- end }}
      </div>
    </a>
    {{- end }}
  </div>
</section>
{{- end }}

{{- if .Content }}
<div class="post-content">
  {{ .Content }}
</div>
{{- end }}

{{- end }}{{/* end main */}}
